(()=>{"use strict";async function e(){var e={email:"",user_id:""};try{await new Promise(((e,t)=>{let n=0;const i=setInterval((()=>{"undefined"!=typeof MemberSpace?(clearInterval(i),e()):(n+=100,n>=1e4&&(clearInterval(i),t("MemberSpace did not become available within the maximum wait time.")))}),100)}));const t=await new Promise(((e,t)=>{if(MemberSpace.ready)try{e(window.MemberSpace.getMemberInfo())}catch(e){t("Error fetching MemberSpace member info: "+e)}else{const n=({detail:i})=>{try{e(i)}catch(e){t("Error in MemberSpace.ready event: "+e)}document.removeEventListener("MemberSpace.ready",n)};document.addEventListener("MemberSpace.ready",n)}}));t&&t.isLoggedIn&&(e.email=t.memberInfo.email,e.user_id=t.memberInfo.id)}catch(e){}return e}const t="https://api.colombochetty.com/",n=t+"api/authenticate",i=t+"auth/logout",a=t+"auth/refresh_token",o=t+"graphql",r={tree:t+"api/tree/",individuals:t+"api/individuals/"},s=new class{async login(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!n.ok)throw n}async logout(e){const t=await fetch(e,{method:"POST",credentials:"include"});if(!t.ok)throw t}async refreshToken(e){const t=this.getCookie("csrf_refresh_token"),n=await fetch(e,{method:"POST",credentials:"include",headers:{"X-CSRF-TOKEN-REFRESH":t}});if(!n.ok)throw n}async getRestData(e){const t=await fetch(e,{method:"GET",credentials:"include"});if(!t.ok)throw t;return await t.text()}async getGraphQLData(e,t){const n=this.getCookie("csrf_access_token"),i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN-ACCESS":n},body:JSON.stringify({query:t}),credentials:"include"});if(!i.ok)throw i;return await i.json()}getCookie(e){let t=null;if(document.cookie&&""!==document.cookie){const n=document.cookie.split(";");for(let i=0;i<n.length;i++){const a=n[i].trim();if(a.substring(0,e.length+1)===e+"="){t=decodeURIComponent(a.substring(e.length+1));break}}}return t}},c=new class{constructor(e,t,n,i,a,o){this.loginUrl=e,this.logoutUrl=n,this.refreshUrl=t,this.memberspace_tokenName=i,this.redirectPage=a,this.apiClient=o}async handleGraphQLError(e,t,n){try{if(this.isUnauthorizedError(e))return await this.handleUnauthorizedError(e),await this.apiClient.getGraphQLData(t,n);throw this.isSigFailure(e),await this.handleLogout(),e}catch(e){throw e}}async handleRestError(e,t){try{if(this.isUnauthorizedError(e))return await this.handleUnauthorizedError(e),await this.apiClient.getRestData(t);throw this.isSigFailure(e),await this.handleLogout(),e}catch(e){throw e}}async handleUnauthorizedError(t){const n=await t.json();if("Token has expired"===n.msg)await this.handleRefresh();else{if('Missing cookie "access_token_cookie"'!==n.msg)throw t;{const t=await e();await this.apiClient.login(this.loginUrl,t)}}}async handleRefresh(){try{await this.apiClient.refreshToken(this.refreshUrl)}catch(e){throw this.handleLogout(),e}}async handleLogout(){localStorage.removeItem(this.memberspace_tokenName),await this.apiClient.logout(this.logoutUrl),window.location.href=this.redirectPage}isUnauthorizedError(e){return e instanceof Response&&401===e.status}isSigFailure(e){return e instanceof Response&&422===e.status}}(n,a,i,"MemberSpaceWidget.token","/account",s);const l={basic:"\n      {\n      individuals {\n        id\n        GIVN\n        SURN\n      }\n    }",with_parents:"\n      {\n      individuals {\n        id\n        GIVN\n        SURN\n        parents {\n          GIVN\n          SURN\n          SEX\n          id \n        } \n      }\n    }",detailed:"\n      {\n      individuals {\n        id\n        GIVN\n        SURN\n        parents {\n          GIVN\n          SURN\n          SEX\n          id \n        } \n        spouses {\n          GIVN\n          SURN\n          id\n          SEX\n        }\n      }\n    }"};async function d(e="basic"){const t=l[e];try{const e=await async function(e){try{return await s.getGraphQLData(o,e)}catch(t){return await c.handleGraphQLError(t,o,e)}}(t);return e}catch(e){throw e}}function u(e,t,n){const i=t.querySelectorAll(":scope > li"),a=i[i.length-1],o=a.getBoundingClientRect().height/2,r=a.getBoundingClientRect(),s=e.getBoundingClientRect(),c=r.bottom-s.bottom-o;t.style.setProperty("--ul-before-margin",`${c}px`);const l=t.parentElement;if(n&null!==l&"UL"===l.tagName){const e=l.previousElementSibling;null!==e&&u(e,l,!0)}}function h(e){for(var t=e.getElementsByClassName("nested"),n=0;n<t.length;n++)t[n].classList.remove("active"),h(t[n]);var i=e.getElementsByClassName("collapsible");for(n=0;n<i.length;n++)i[n].classList.remove("active")}function m(e){e.classList.toggle("active");const t=e.parentElement.parentElement.parentElement,n=t.nextElementSibling;n.classList.toggle("active"),u(t,n,!0),e.classList.contains("active")?e.textContent="":(e.textContent="",h(n))}var f=!1;const g="tree",p="/person?id=";async function y(e,t=!0){try{const n=await async function(e,t){const n=r[e]+t;try{return await s.getRestData(n)}catch(e){return await c.handleRestError(e,n)}}(g,e);document.getElementById("tree-content").innerHTML=n,function(){f=!1,document.getElementsByClassName("root")[0];var e=document.getElementsByClassName("level-0")[0];e&&u(e.previousElementSibling,e,!1);var t,n=document.getElementsByClassName("collapsible");for(t=0;t<n.length;t++)n[t].addEventListener("click",(function(){m(this)}));var i=document.querySelector(".sticky-bar"),a=.5*window.innerHeight;window.addEventListener("scroll",(function(){window.pageYOffset>a?i.classList.remove("bar-hidden"):i.classList.add("bar-hidden")}));const o=function(e,t){let n;return function(){const i=this,a=arguments;clearTimeout(n),n=setTimeout((function(){n=null,e.apply(i,a)}),t)}}((function(){for(var e=document.querySelectorAll(".nested.active"),t=0;t<e.length;t++){var n=e[t];u(n.previousElementSibling,n,!1)}}),10);window.addEventListener("resize",o)}(),t?document.querySelectorAll(".tree-link").forEach((function(e){e.addEventListener("click",(function(){y(this.dataset.treeId)}))})):document.querySelectorAll(".tree-link").forEach((function(e){e.addEventListener("click",(function(){const e=p+this.dataset.treeId;window.location.href=e}))})),document.querySelectorAll(".profile-link").forEach((function(e){e.addEventListener("click",(function(){const e=p+this.dataset.profileId;window.location.href=e}))}))}catch(e){throw e}}const w="tree_id",v="I0001";let E=v,S=!1;async function L(){const e=document.getElementById("search-input"),t=document.getElementById("dropdown"),n=document.getElementById("selected-id");try{await y(E);const i=await async function(){const e=(await d()).data.individuals;return e.sort(((e,t)=>function(e,t){const n=e.GIVN?e.GIVN.toLowerCase():"",i=t.GIVN?t.GIVN.toLowerCase():"",a=e.SURN?e.SURN.toLowerCase():"",o=t.SURN?t.SURN.toLowerCase():"";if(n===i)return a.localeCompare(o);return n.localeCompare(i)}(e,t)))}();e.addEventListener("input",(()=>function(e,t,n,i){const a=e.value.toLowerCase();t.innerHTML="";const o=i.filter((e=>`${e.GIVN} ${e.SURN}`.toLowerCase().includes(a)));!function(e,t,n,i,a){1===i.length&&`${i[0].GIVN} ${i[0].SURN}`.toLowerCase()===a&&n.value!=i[0].id?(n.value=i[0].id,e.value=`${i[0].GIVN} ${i[0].SURN} (${i[0].id})`,t.style.display="none",y(i[0].id)):a.length>1?function(e,t,n,i){i.forEach((i=>{let a=document.createElement("div");a.textContent=`${i.GIVN} ${i.SURN} (${i.id})`,a.onclick=()=>function(e,t,n,i){t.value=`${e.GIVN} ${e.SURN} (${e.id})`,n.value=e.id,i.innerHTML="",i.style.display="none",y(e.id)}(i,t,n,e),e.appendChild(a)})),e.style.display="block"}(t,e,n,i):t.style.display="none"}(e,t,n,o,a)}(e,t,n,i))),e.addEventListener("blur",(()=>function(e){setTimeout((()=>{e.contains(document.activeElement)||(e.style.display="none")}),200)}(t))),S=!0}catch(e){}}document.addEventListener("DOMContentLoaded",(async function(){document.getElementById("activate_all").addEventListener("click",(function(){!function(){document.getElementsByClassName("root")[0];for(var e=document.getElementsByClassName("level-0")[0],t=document.getElementsByClassName("nested"),n=0;n<t.length;n++){var i=t[n];f?i.classList.contains("level-0")||i.classList.remove("active"):i.classList.add("active")}if(f)u(e.previousElementSibling,e,!1);else for(n=0;n<t.length;n++)u((i=t[n]).previousElementSibling,i,!1);var a=document.getElementsByClassName("collapsible");for(n=0;n<a.length;n++){var o=a[n];f?o.classList.remove("active"):o.classList.add("active")}f=!f}()})),E=function(){const e=function(e,t=!0){const n=localStorage.getItem(e);return null!==n?(t&&localStorage.removeItem(e),n):null}(w);if(null===e)return v;return e}(),await L()})),document.addEventListener("MemberSpace.member.info",(async function(){S||await L()}))})();