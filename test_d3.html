<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genealogy Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .node circle {
            fill: #fff;
            stroke: steelblue;
            stroke-width: 3px;
        }

        .node text {
            font: 12px sans-serif;
        }

        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 2px;
        }
    </style>
</head>
<body>
    <script>
        const csvData = `person_id,father_id,mother_id
1,2,3
2,4,5
3,,
4,,
5,,`;

        // Parse the CSV data into a hierarchical structure
        function processData(data) {
            const idMap = {};

            // Create empty objects with person_id as keys for all records
            data.forEach(d => {
                d.children = [];
                idMap[d.person_id] = d;
            });

            // Fill in the missing parent records if not already present
            data.forEach(d => {
                if (d.father_id && !idMap[d.father_id]) {
                    idMap[d.father_id] = { person_id: d.father_id, children: [] };
                    data.push(idMap[d.father_id]);
                }
                if (d.mother_id && !idMap[d.mother_id]) {
                    idMap[d.mother_id] = { person_id: d.mother_id, children: [] };
                    data.push(idMap[d.mother_id]);
                }
            });

            // Update the children array for fathers and mothers
            data.forEach(d => {
                if (d.father_id) {
                    const father = idMap[d.father_id];
                    if (father) father.children.push(d);
                }
                if (d.mother_id) {
                    const mother = idMap[d.mother_id];
                    if (mother) mother.children.push(d);
                }
            });

            // Find all root nodes, which have no father and mother
            const roots = data.filter(d => !d.father_id && !d.mother_id);
            return roots;
        }
          

        // Create the family tree visualization using D3.js
        function createFamilyTree(data) {
            const margin = { top: 20, right: 120, bottom: 20, left: 120 };
            const width = 1600 - margin.left - margin.right;
            const height = 900 - margin.top - margin.bottom;

            const svg = d3
                .select("body")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const tree = d3.tree().nodeSize([100, 300]);
            data.forEach((rootData, i) => {
                const root = d3.hierarchy(rootData);
                const treeData = tree(root);

                const nodes = treeData.descendants();
                const links = treeData.links();

                const node = svg
                    .selectAll(`.node-${i}`)
                    .data(nodes)
                    .enter()
                    .append("g")
                    .attr("class", `node node-${i}`)
                    .attr("transform", (d) => `translate(${d.x},${d.y})`);

                node
                    .append("rect")
                    .attr("width", 100)
                    .attr("height", 50)
                    .attr("fill", "white")
                    .attr("stroke", "black");

                node
                    .append("text")
                    .attr("dy", "1.5em")
                    .attr("dx", "1em")
                    .text((d) => `Father: ${d.data.father_id}`);

                node
                    .append("text")
                    .attr("dy", "2.5em")
                    .attr("dx", "1em")
                    .text((d) => `Mother: ${d.data.mother_id}`);

                const link = svg
                    .selectAll(`.link-${i}`)
                    .data(links)
                    .enter()
                    .append("path")
                    .attr("class", `link link-${i}`)
                    .attr("d", d3.linkHorizontal()
                        .x(d => d.x + 50)
                        .y(d => d.y + 25));
            });
        }
        // Parse CSV and create the visualization
        const data_csv = d3.csvParse(csvData, d3.autoType);
        console.log("data")
        console.log(data_csv)
        const hierarchicalData = processData(data_csv);
        console.log("hierarchicalData")
        console.log(hierarchicalData)
        createFamilyTree(hierarchicalData);
        </script>

</body>
</html>